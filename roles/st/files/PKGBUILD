# Maintainer: dezeroku <dezeroku gmail com>

# Based on:
# Maintainer: Jose Riha <jose1711 gmail com>
# Contributor: Patrick Jackson <PatrickSJackson gmail com>
# Contributor: Christoph Vigano <mail@cvigano.de>

pkgname=st_custom
realname=st
pkgver=0.8.1
pkgrel=2
pkgdesc='A simple virtual terminal emulator for X.'
arch=('i686' 'x86_64' 'armv7h')
license=('MIT')
depends=('libxft' 'libxext' 'xorg-fonts-misc')
makedepends=('ncurses')
conflicts=('st')
_patches=(
"https://st.suckless.org/patches/alpha/st-alpha-0.8.1.diff"
"https://st.suckless.org/patches/anysize/st-anysize-0.8.1.diff"
"https://st.suckless.org/patches/hidecursor/st-hidecursor-0.8.1.diff"
#"https://st.suckless.org/patches/scrollback/st-scrollback-0.8.1.diff"
#"https://st.suckless.org/patches/scrollback/st-scrollback-mouse-0.8.diff"
#"https://st.suckless.org/patches/scrollback/st-scrollback-mouse-altscreen-20190131-e23acb9.diff"
)
url="http://st.suckless.org"
source=(http://dl.suckless.org/st/$realname-$pkgver.tar.gz config.h ${_patches[@]})

prepare() {
  # user is supposed to maintain config.h him/herself
  cp $srcdir/config.h $srcdir/$realname-$pkgver/config.h
  cp $srcdir/*.diff $srcdir/$realname-$pkgver
  cd $srcdir/$realname-$pkgver
  for patch in "${_patches[@]}"; do
    echo "Applying patch $(basename $patch)..."
    patch -Np1 -i "$(basename $patch)"
  done
  cd -
}

build() {
  cd $srcdir/$realname-$pkgver
  make X11INC=/usr/include/X11 X11LIB=/usr/lib/X11
}

package() {
  cd $srcdir/$realname-$pkgver
  # This is a wild hack to fix up tic -sx missing permissions
  # Basically a copy-paste with modifications from Makefile
  # Instead of a proper patch
  mkdir -p $pkgdir/usr/bin
  cp -f st $pkgdir/usr/bin
  chmod 755 $pkgdir/usr/bin/st

  mkdir -p $pkgdir/usr/share/man/man1
  sed "s/VERSION/0.8.1/g" < st.1 > $pkgdir/usr/share/man/man1/st.1
  chmod 644 $pkgdir/usr/share/man/man1/st.1

  mkdir -p $pkgdir/usr/share/terminfo
  tic -sx st.info -o $pkgdir/usr/share/terminfo
  #make PREFIX=/usr DESTDIR="$pkgdir" TERMINFO="$pkgdir/usr/share/terminfo" install
  #install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$realname/LICENSE"
  #install -Dm644 README "$pkgdir/usr/share/doc/$realname/README"
  # remove to avoid conflict with ncurses
  rm "${pkgdir}/usr/share/terminfo/s/st" "${pkgdir}/usr/share/terminfo/s/st-256color"
}
md5sums=('92135aecdba29300bb2e274a55f5b71e'
         'd391ab512269ddf580dc498c8df07d9f'
         'fa88f0830e8c838ed91ee6f143f34a9d'
         'ad12bbcaa02000a0a4f144cc2139a879'
         'ad0a090493efc9e8bf5f01dcd4353086')
