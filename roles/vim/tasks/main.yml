---
- name: Install vim, neovim and spelling packages
  become: true
  become_user: root
  community.general.pacman:
    name:
      - gvim
      - neovim
      - vim-spell-en
      - vim-spell-pl
      - vim-spell-de

- name: Copy vim vundle bootstrap
  become: true
  become_user: "{{ user.name }}"
  ansible.builtin.copy:
    src: vundler.vim
    dest: ~/.vundler.vim
  register: var_vundler

- name: Template vim .vimrc
  become: true
  become_user: "{{ user.name }}"
  ansible.builtin.template:
    src: vimrc
    dest: ~/.vimrc

- name: Ensure directory exists
  become: true
  become_user: "{{ user.name }}"
  ansible.builtin.file:
    path: ~/.config/nvim
    state: directory
    recurse: true

- name: Template neovim config
  become: true
  become_user: "{{ user.name }}"
  ansible.builtin.template:
    src: vimrc
    dest: ~/.config/nvim/init.vim

- name: Copy tern config
  become: true
  become_user: "{{ user.name }}"
  ansible.builtin.copy:
      src: tern-config
      dest: ~/tern-config

- name: Ensure directory exists
  become: true
  become_user: "{{ user.name }}"
  ansible.builtin.file:
    path: ~/.vim/bundle
    state: directory
    recurse: true

- name: Set up Vundle
  become: true
  become_user: "{{ user.name }}"
  ansible.builtin.git:
    dest: ~/.vim/bundle/Vundle.vim
    repo: https://github.com/VundleVim/Vundle.vim.git
    version: b255382d6242d7ea3877bf059d2934125e0c4d95 # last commit from 2019, newest as of today
  register: var_vundle_git

- name: Download plugins if something changed
  become: true
  become_user: "{{ user.name }}"
  ansible.builtin.command: vim +PluginInstall +qall -u ~/.vundler.vim
  when: var_vundler.changed or var_vundle_git.changed
